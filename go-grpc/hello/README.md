# Steps to develop a sample gRPC service/client

## Create a Go module and define a service in a .proto file.
- mkdir -p go-grpc/hello
- cd go-grpc/hello
- go mod init github.com/rajkumar-km/go-play/go-grpc/hello
- mkdir server client proto
- Define the service in .proto file. See proto/hello.proto
## Generate server and client stubs using the protocol buffer compiler (protoc).
- RUn protoc to generate server/client stubs
    - protoc --go_out=. --go_opt=paths=source_relative \
            --go-grpc_out=. --go-grpc_opt=paths=source_relative \
            proto/hello.proto
- Couple of go files are generated as a result and placed under proto/
    - hello.pb.go is generated by protoc-gen-go which contains the
      go structs for data models, and serialization code.
    - hello_grpc.pb.go is generated by protoc-gen-go-grpc and contains the
      interface for server/client stubs.
- The generated stubs uses Go packages "google.golang.org/grpc" and
  "google.golang.org/protobuf". So run,
    - go get google.golang.org/grpc
    - go get google.golang.org/protobuf
## Use the Go gRPC API to write a simple client and server for your service.
- Implement the gRPC server. See server/server.go
    - An interface is generated by protoc. We need to implement the
      interface for doing the actual work.
    - Start the gRPC server
- Implement the gRPC client. See client/client.go
    - Create a client connection to the gRPC server using grpc.Dial()
    - Create an instance of client stub with the new connection and
      invoke the RPCs.
- Run the server
    - go run server/server.go
- Run client
    - go run client/client.go

## Testing gRPC APIs using grpcurl
- Install the grpcurl tool that can be used for testing gRPC service
    - go install github.com/fullstorydev/grpcurl/cmd/grpcurl@latest
- For No-TLS and No-Reflection gRPC service
    - Use -plaintext option if TLS is not supported by gRPC service
    - Reflection is another gRPC feature to expose the gRPC schema to consumers.
      If gRPC service supports reflection, then grpcurl automatically determines
      the API schema. Otherwise, we need to supply either:
        - -protoset <a compiled binary> (or)
        - -proto <.proto file> [--import-path <imported .proto path>]
    - Examples using plain proto:
        - grpcurl -proto proto/hello.proto -plaintext localhost:50051 proto.Hello.SayHello
        - grpcurl -proto proto/hello.proto -plaintext -d '{"name": "grpcurlClient"}' localhost:50051 proto.Hello.SayHello
        - Note: Must use -import-path <path> option in case if your .proto imports
          other proto files in the path.
    - Examples using compiled protoset
        - Compile the proto using
            - protoc --descriptor_set_out=proto/hello.protoset proto/hello.proto
            - (or)
            - protoc --proto_path=. \
                     --include_imports \
                     --descriptor_set_out=proto/hello.protoset \
                     proto/hello.proto
        - grpcurl -protoset proto/hello.protoset -plaintext localhost:50051 proto.Hello.SayHello
        - grpcurl -protoset proto/hello.protoset -plaintext -d '{"name": "grpcurlClient"}' localhost:50051 proto.Hello.SayHello
        - Note: protoc compilation required for every change in .proto file.

- For gRPC services that supports TLS and reflection
    - grpcurl localhost:50051 proto.Hello.SayHello
    - grpcurl -d '{"name": "grpcurlClient"}' localhost:50051 proto.Hello.SayHello
    - Enabling reflection for a gRPC service is simple:
        - reflection.Register(s)

- Listing and describing gRPC schema
    - grpcurl -plaintext localhost:50051 list
    - grpcurl -plaintext localhost:50051 describe
    - Note: Add -proto or -protoset if reflection is not supported by gRPC
